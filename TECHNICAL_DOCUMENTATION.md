# BioSync - Umfassende Technische Dokumentation
## KlÃ¤rgruben-Monitoring-System

**Version:** 2.0  
**Datum:** November 2025  
**Autor:** LukeArrow, BioSync Development Team  
**Status:** Produktionsreif

---

## Dokumenten-Ãœbersicht

Dieses Dokument bietet eine sehr detaillierte technische Beschreibung des BioSync KlÃ¤rgruben-Monitoring-Systems. Es richtet sich an Techniker, Entwickler und Wartungspersonal, die das System verstehen, aufbauen, in Betrieb nehmen oder erweitern mÃ¶chten.

### Zielgruppe

- **Elektronik-Techniker:** FÃ¼r Hardware-Aufbau und -Wartung
- **Software-Entwickler:** FÃ¼r Firmware-Anpassungen und Erweiterungen
- **Installations-Techniker:** FÃ¼r Montage und Inbetriebnahme
- **Wartungspersonal:** FÃ¼r Wartung, Diagnose und Reparatur

### Verwandte Dokumente

- **[HARDWARE_DETAILED.md](HARDWARE_DETAILED.md)** - Detaillierte Hardware-Dokumentation
- **[SOFTWARE_ARCHITECTURE.md](SOFTWARE_ARCHITECTURE.md)** - Software-Architektur und Code-Dokumentation
- **[SENSOR_INTEGRATION.md](SENSOR_INTEGRATION.md)** - Sensor-spezifische Dokumentation
- **[COMMUNICATION_PROTOCOL.md](COMMUNICATION_PROTOCOL.md)** - RS-485 Protokoll-Spezifikation
- **[NEXTION_HMI_GUIDE.md](NEXTION_HMI_GUIDE.md)** - Nextion HMI Anleitung
- **[TROUBLESHOOTING_GUIDE.md](TROUBLESHOOTING_GUIDE.md)** - Fehlerbehebung
- **[CALIBRATION_PROCEDURES.md](CALIBRATION_PROCEDURES.md)** - Kalibrierungsverfahren
- **[INSTALLATION_DETAILED.md](INSTALLATION_DETAILED.md)** - Installationsanleitung
- **[WIRING_GUIDE.md](WIRING_GUIDE.md)** - Verdrahtungsanleitung

---

## Inhaltsverzeichnis

1. [SystemÃ¼bersicht](#1-systemÃ¼bersicht)
2. [Technische Architektur](#2-technische-architektur)
3. [Systemkomponenten](#3-systemkomponenten)
4. [Stromversorgungsarchitektur](#4-stromversorgungsarchitektur)
5. [Kommunikationssystem](#5-kommunikationssystem)
6. [Betriebsmodi und Zustandsmaschinen](#6-betriebsmodi-und-zustandsmaschinen)
7. [Timing und Synchronisation](#7-timing-und-synchronisation)
8. [Fehlerbehandlung und Redundanz](#8-fehlerbehandlung-und-redundanz)
9. [Performance-Charakteristiken](#9-performance-charakteristiken)
10. [Umgebungsbedingungen und ZuverlÃ¤ssigkeit](#10-umgebungsbedingungen-und-zuverlÃ¤ssigkeit)
11. [Erweiterbarkeit und Skalierbarkeit](#11-erweiterbarkeit-und-skalierbarkeit)
12. [Sicherheit und Compliance](#12-sicherheit-und-compliance)
13. [AnhÃ¤nge](#13-anhÃ¤nge)

---

## 1. SystemÃ¼bersicht

### 1.1 Projektbeschreibung

BioSync ist ein verteiltes Echtzeit-Monitoring-System zur kontinuierlichen Ãœberwachung von KlÃ¤rgruben und Abwasser-Systemen. Das System erfasst kritische Parameter wie FÃ¼llstand, Temperatur, TrÃ¼bung und TDS-Wert (Total Dissolved Solids) und visualisiert diese auf einem benutzerfreundlichen Touchdisplay.

#### Hauptziele

- **ZuverlÃ¤ssigkeit:** 99,9% VerfÃ¼gbarkeit im Dauerbetrieb
- **Wartungsarmut:** Minimaler Wartungsaufwand durch robuste Komponenten
- **Benutzerfreundlichkeit:** Intuitive Bedienung Ã¼ber Touchdisplay
- **Erweiterbarkeit:** Modularer Aufbau fÃ¼r zukÃ¼nftige Erweiterungen
- **Kosteneffizienz:** Einsatz kostengÃ¼nstiger Standard-Komponenten

### 1.2 Systemarchitektur - Ãœberblick

Das BioSync-System besteht aus drei Hauptknoten (Nodes), die Ã¼ber RS-485 Verbindungen kommunizieren:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    BIOSYNC SYSTEM ARCHITEKTUR (v2.0)                           â•‘
â•‘                          3-Node Architecture                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SensorNode  â”‚â”€RS485â”€â”€â†’â”‚ DisplayNode â”‚â†â”€RS485â”€â”€â”‚ RelayNode   â”‚
â”‚ (Schacht)   â”‚ Serial1 â”‚ (Haus)      â”‚ Serial3 â”‚ (Schrank)   â”‚
â”‚             â”‚         â”‚             â”‚         â”‚             â”‚
â”‚ â€¢ JSN-SR04T â”‚         â”‚ â€¢ Nextion   â”‚         â”‚ â€¢ 4Ã— ALS    â”‚
â”‚ â€¢ DS18B20   â”‚         â”‚ â€¢ RTC â°    â”‚         â”‚   -PT19     â”‚
â”‚ â€¢ TSW-20M   â”‚         â”‚ â€¢ SD ğŸ’¾     â”‚         â”‚             â”‚
â”‚ â€¢ TDS       â”‚         â”‚             â”‚         â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     Nano Every            Mega 2560              Nano Every
     
     
ğŸ  DISPLAY NODE (Haus) - Central Hub
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Arduino Mega 2560                              â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  Serial1 (D18/D19) â†â”€ SensorNode RS-485 â”€ Sensor data           â”‚  â”‚
â”‚  â”‚  Serial2 (D16/D17) â†â†’ Nextion Display    â”€ HMI control          â”‚  â”‚
â”‚  â”‚  Serial3 (D14/D15) â†â”€ RelayNode RS-485   â”€ LED status           â”‚  â”‚
â”‚  â”‚  IÂ²C (D20/D21)     â†â†’ RTC DS3231         â”€ Timestamps â°        â”‚  â”‚
â”‚  â”‚  SPI (D50-D53)     â†â†’ SD Card            â”€ Data logging ğŸ’¾      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Nextion Displayâ”‚    â”‚ RTC      â”‚    â”‚ SD Card      â”‚               â”‚
â”‚  â”‚ 3.2" Touch     â”‚    â”‚ DS3231   â”‚    â”‚ FAT32        â”‚               â”‚
â”‚  â”‚ 320x240        â”‚    â”‚ CR2032   â”‚    â”‚ sensor.csv   â”‚               â”‚
â”‚  â”‚                â”‚    â”‚          â”‚    â”‚ relay.csv    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚  â”‚ 12V Netzteil   â”‚â”€â”€â†’ Powers all 3 nodes via distribution            â”‚
â”‚  â”‚ (2A)           â”‚                                                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸŒŠ SENSOR NODE (Schacht)         âš¡ RELAY NODE (Schaltschrank)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Arduino Nano Every  â”‚         â”‚  Arduino Nano Every  â”‚
â”‚                      â”‚         â”‚                      â”‚
â”‚  â€¢ JSN-SR04T (D2/D3) â”‚         â”‚  â€¢ ALS-PT19 #1 (A0)  â”‚
â”‚  â€¢ DS18B20 (D4)      â”‚         â”‚  â€¢ ALS-PT19 #2 (A1)  â”‚
â”‚  â€¢ TSW-20M (A0)      â”‚         â”‚  â€¢ ALS-PT19 #3 (A2)  â”‚
â”‚  â€¢ TDS (A1)          â”‚         â”‚  â€¢ ALS-PT19 #4 (A3)  â”‚
â”‚  â€¢ RS-485 (D6/D7)    â”‚         â”‚  â€¢ RS-485 (D6/D7)    â”‚
â”‚                      â”‚         â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚  Monitors:           â”‚
â”‚  â”‚ LM2596         â”‚  â”‚         â”‚  - Pump LED          â”‚
â”‚  â”‚ 12Vâ†’5V         â”‚  â”‚         â”‚  - Vent LED          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  - Status LEDs       â”‚
â”‚                      â”‚         â”‚                      â”‚
â”‚  IP67 Enclosure      â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚ LM2596         â”‚  â”‚
                                 â”‚  â”‚ 12Vâ†’5V         â”‚  â”‚
                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Systemkomponenten

**Display Node (Central Hub):**
- EmpfÃ¤ngt Sensordaten vom Sensor Node (Serial1)
- EmpfÃ¤ngt Relay-Status vom Relay Node (Serial3)
- Verarbeitet und validiert empfangene Daten
- Steuert das Nextion Touchdisplay (Serial2)
- **RTC DS3231:** Generiert prÃ¤zise Zeitstempel fÃ¼r alle Logs â°
- **SD-Card Logger:** Speichert Sensor- und Relay-Daten langfristig ğŸ’¾
  - `sensor.csv`: Periodisches Logging alle 20 Minuten
  - `relay.csv`: Event-gesteuertes Logging bei StatusÃ¤nderungen
- Bietet Benutzerinteraktion Ã¼ber Touch-Display
- Zentrale Stromversorgung fÃ¼r alle drei Nodes

**Sensor Node:**
- Erfasst Messwerte von 4 Sensoren (Distanz, Temperatur, TrÃ¼bung, TDS)
- Verarbeitet Rohdaten lokal
- Sendet formatierte Daten periodisch alle 5 Sekunden
- Nachrichtenformat: `<SENSOR;DIST=xxx;TMP=xx;TUR=xxx;TDS=xxx>`
- Autonomer Betrieb ohne BestÃ¤tigung
- Powered Ã¼ber CAT7 vom Display Node

**Relay Node (NEW in v2.0):** âš¡
- Ãœberwacht 4 Schrack-Relay-LEDs mit ALS-PT19 Lichtsensoren
- Erkennt LED-ZustÃ¤nde: IDLE, ACTIVE, ERROR (blinkend)
- Event-getriebene Kommunikation (sendet nur bei StatusÃ¤nderung)
- Nachrichtenformat: `<RELAY;PUMP=ACTIVE;VENT=IDLE;LED3=IDLE;LED4=IDLE>`
- Reduziert Bus-Traffic durch intelligente Filterung
- Powered Ã¼ber separates 12V Netzteil im Schaltschrank

**Kommunikations-Links:**
- **RS-485 A (SensorNode â†” DisplayNode):**
  - Differenzielle Ãœbertragung Ã¼ber CAT7-Kabel
  - Distanzen bis 100m mÃ¶glich
  - 9600 Baud, 8N1
- **RS-485 B (RelayNode â†” DisplayNode):**
  - Twisted Pair Kabel
  - Event-basierte Ãœbertragung
  - 9600 Baud, 8N1

### 1.3 Hauptmerkmale

#### Hardware-Merkmale

- **Dual-Mikrocontroller-Architektur:** Getrennte Verarbeitung fÃ¼r Sensordaten und Display
- **Robuste Kommunikation:** RS-485 mit hoher StÃ¶rsicherheit
- **Redundante Stromversorgung:** Parallele AdernfÃ¼hrung im CAT7-Kabel
- **Wasserdichtes Design:** IP67-Schutz fÃ¼r Sensor Node
- **Kapazitives Touchdisplay:** Moderne BenutzeroberflÃ¤che

#### Software-Merkmale

- **Modulares Design:** Klare Trennung der Funktionsmodule
- **Fehlertoleranz:** Graceful Degradation bei SensorausfÃ¤llen
- **Echtzeit-Verarbeitung:** Deterministisches Timing
- **Protokoll-basiert:** Strukturierte Datenkommunikation
- **Erweiterbar:** Einfache Integration neuer Sensoren

#### Betriebsmerkmale

- **Automatischer Betrieb:** Keine manuelle Konfiguration erforderlich
- **Niedrige Latenz:** <500ms vom Sensor bis Display
- **Hohe Update-Rate:** Neue Werte alle 5 Sekunden
- **Wartungsfreundlich:** Modularer Austausch von Komponenten
- **Energieeffizient:** <2W Gesamtverbrauch

---

## 2. Technische Architektur

### 2.1 Systemarchitektur-Diagramm (Detailliert)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    BIOSYNC DETAILLIERTE SYSTEMARCHITEKTUR                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DISPLAY NODE (Master) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Arduino Mega 2560 (ATmega2560)                        â”‚    â”‚
â”‚  â”‚                                                                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚
â”‚  â”‚  â”‚   USB/Debug  â”‚  â”‚   RS-485     â”‚  â”‚   Nextion    â”‚  â”‚  GPIO/Ext.   â”‚â”‚    â”‚
â”‚  â”‚  â”‚   Serial0    â”‚  â”‚   Serial1    â”‚  â”‚   Serial2    â”‚  â”‚   Expansion  â”‚â”‚    â”‚
â”‚  â”‚  â”‚   (115200)   â”‚  â”‚   (9600)     â”‚  â”‚   (9600)     â”‚  â”‚              â”‚â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
â”‚  â”‚         â”‚                 â”‚                  â”‚                          â”‚    â”‚
â”‚  â”‚         â–¼                 â–¼                  â–¼                          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
â”‚  â”‚  â”‚              Hauptprogramm-Loop (loop())                     â”‚      â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ RS-485 RX       â”‚  â”‚  Message Parser â”‚  â”‚  Nextion     â”‚â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ Buffer Manager  â”‚â†’ â”‚  (Protocol)     â”‚â†’ â”‚  Updater     â”‚â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚              â”‚â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ - Ring Buffer   â”‚  â”‚ - Extract Data  â”‚  â”‚ - Format Cmd â”‚â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ - Line Detectionâ”‚  â”‚ - Validate      â”‚  â”‚ - Send 3xFF  â”‚â”‚      â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚      â”‚    â”‚
â”‚  â”‚  â”‚                                                               â”‚      â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
â”‚  â”‚                                                                           â”‚    â”‚
â”‚  â”‚  Memory Usage:                                                            â”‚    â”‚
â”‚  â”‚  - Flash: ~15 KB / 256 KB                                                â”‚    â”‚
â”‚  â”‚  - SRAM:  ~2 KB / 8 KB                                                   â”‚    â”‚
â”‚  â”‚                                                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        RS-485 Transceiver Module                          â”‚    â”‚
â”‚  â”‚                                                                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚    â”‚
â”‚  â”‚  â”‚  MAX485 / SN75   â”‚         â”‚  Termination     â”‚                       â”‚    â”‚
â”‚  â”‚  â”‚  - RO â†’ RX1      â”‚         â”‚  (Optional)      â”‚                       â”‚    â”‚
â”‚  â”‚  â”‚  - DI â†’ TX1      â”‚         â”‚  120Î© A-B        â”‚                       â”‚    â”‚
â”‚  â”‚  â”‚  - DE/RE â†’ GND   â”‚         â”‚  (>50m cable)    â”‚                       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚    â”‚
â”‚  â”‚         A â”‚ B                                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           â”‚          Nextion NX4024T032 Display                           â”‚  â”‚
â”‚  â”‚           â”‚                                                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ STM32  â”‚Controllerâ”‚  â”‚ 3.2" TFT LCD   â”‚  â”‚ Resistive Touch      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚        â”‚          â”‚  â”‚ 320x240 px     â”‚  â”‚ Controller           â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - RX â† TX2       â”‚  â”‚ 65K Colors     â”‚  â”‚                      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ - TX â†’ RX2       â”‚  â”‚                â”‚  â”‚ Touch Events â†’ STM32 â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  HMI Elements:                                                           â”‚  â”‚
â”‚  â”‚  - tDist (Text): FÃ¼llstand in cm                                         â”‚  â”‚
â”‚  â”‚  - tTemp (Text): Temperatur in Â°C                                        â”‚  â”‚
â”‚  â”‚  - tTurb (Text): TrÃ¼bung (0-1023)                                        â”‚  â”‚
â”‚  â”‚  - tTDS (Text): TDS-Wert in ppm                                          â”‚  â”‚
â”‚  â”‚  - Timer: Screensaver (60s idle)                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Stromversorgung Display Node                            â”‚   â”‚
â”‚  â”‚                                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ 12V/2A      â”‚      â”‚ LM2596        â”‚        â”‚ Distribution     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ AC/DC PSU   â”‚â”€â”€â”€â”€â”€â†’â”‚ Buck Conv.    â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Mega: 5V         â”‚     â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  12V â”‚ 12Vâ†’5V        â”‚  5V    â”‚ Nextion: 5V      â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - OVP       â”‚      â”‚ - Iout: 3A    â”‚        â”‚ RS-485: 5V       â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ - OCP       â”‚      â”‚ - Eff.: 92%   â”‚        â”‚                  â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚        â”‚                                                                  â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 12V Ã¼ber CAT7 zu Sensor Node â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ CAT7 Kabel
                                          â”‚ - Adern 1+2: 12V+
                                          â”‚ - Adern 3+4: GND
                                          â”‚ - Adern 5+6: RS-485 (A/B)
                                          â”‚ - Adern 7+8: Reserve
                                          â”‚
                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SENSOR NODE (Slave) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Stromversorgung Sensor Node                             â”‚   â”‚
â”‚  â”‚                                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ 12V vom Haus  â”‚      â”‚ LM2596        â”‚        â”‚ Distribution     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ (CAT7 1+2)    â”‚â”€â”€â”€â”€â”€â†’â”‚ Buck Conv.    â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Nano: 5V         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚               â”‚  12V â”‚ 12Vâ†’5V        â”‚  5V    â”‚ Sensoren: 5V     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚               â”‚      â”‚ - Iout: 3A    â”‚        â”‚ RS-485: 5V       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚               â”‚      â”‚ - Eff.: 92%   â”‚        â”‚                  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Arduino Nano Every (ATmega4809)                               â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚   USB/Debug  â”‚  â”‚   Digital    â”‚  â”‚   Analog     â”‚  â”‚  Software    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   Serial     â”‚  â”‚   I/O        â”‚  â”‚   Inputs     â”‚  â”‚  Serial      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   (115200)   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  (9600)      â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚         â”‚                 â”‚                  â”‚                 â”‚         â”‚  â”‚
â”‚  â”‚         â–¼                 â–¼                  â–¼                 â–¼         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚              Hauptprogramm-Loop (loop())                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Sensor Read  â”‚  â”‚ Data Process â”‚  â”‚  RS-485 Transmitter      â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Manager      â”‚â†’ â”‚ & Format     â”‚â†’ â”‚                          â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  - Set DE HIGH           â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Every 5000ms â”‚  â”‚ Build String â”‚  â”‚  - Send Message          â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  - Set DE LOW            â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚  Memory Usage:                                                              â”‚  â”‚
â”‚  â”‚  - Flash: ~10 KB / 48 KB                                                   â”‚  â”‚
â”‚  â”‚  - SRAM:  ~1 KB / 6 KB                                                     â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Sensor Array                                        â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ JSN-SR04T          â”‚  â”‚ DS18B20 (MICREEN)  â”‚  â”‚ TSW-20M            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Ultrasonic Distanceâ”‚  â”‚ Digital Temperatureâ”‚  â”‚ Turbidity (Analog) â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                     â”‚  â”‚                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ TRIG â†’ D2          â”‚  â”‚ DATA â†’ D4          â”‚  â”‚ OUT â†’ A0           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ECHO â†’ D3          â”‚  â”‚ + 4.7kÎ© Pull-up    â”‚  â”‚                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Range: 2-400cm     â”‚  â”‚ Range: -55 to 125Â°Câ”‚  â”‚ Range: 0-1023      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Accuracy: Â±1cm     â”‚  â”‚ Accuracy: Â±0.5Â°C   â”‚  â”‚ Response: <2s      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ Waterproof: IP68   â”‚  â”‚ Waterproof: IP68   â”‚  â”‚ Optical Sensor     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚  â”‚
â”‚  â”‚  â”‚ CQRSENTDS01        â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”‚ TDS (Analog)       â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”‚ OUT â†’ A1           â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”‚ Range: 0-1000ppm   â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”‚ Response: <10s     â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”‚ Electrode-based    â”‚                                                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        RS-485 Transceiver Module                           â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚  â”‚
â”‚  â”‚  â”‚  MAX485 / SN75   â”‚         â”‚  Termination     â”‚                        â”‚  â”‚
â”‚  â”‚  â”‚  - RO â†’ D7 (RX)  â”‚         â”‚  (Optional)      â”‚                        â”‚  â”‚
â”‚  â”‚  â”‚  - DI â†’ D6 (TX)  â”‚         â”‚  120Î© A-B        â”‚                        â”‚  â”‚
â”‚  â”‚  â”‚  - DE/RE â†’ D5    â”‚         â”‚  (>50m cable)    â”‚                        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
â”‚  â”‚         A â”‚ B                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CAT7 Adern 5+6 zurÃ¼ck zu Display Node â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      IP67 Enclosure                                       â”‚   â”‚
â”‚  â”‚                                                                            â”‚   â”‚
â”‚  â”‚  - Material: ABS/Polycarbonat                                             â”‚   â”‚
â”‚  â”‚  - Schutzklasse: IP67 (Staub- und Wasserdicht)                            â”‚   â”‚
â”‚  â”‚  - Cable Glands: M12 fÃ¼r CAT7 und Sensorkabel                             â”‚   â”‚
â”‚  â”‚  - Desiccant: Silica Gel Beutel gegen Kondensation                        â”‚   â”‚
â”‚  â”‚  - Betriebstemperatur: -10Â°C bis +50Â°C                                    â”‚   â”‚
â”‚  â”‚  - Abmessungen: ca. 150x100x70mm                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Datenfluss-Diagramm

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          DATENFLUSS IM BIOSYNC-SYSTEM                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SENSOR NODE                                              DISPLAY NODE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Timer     â”‚
â”‚ (5 Sekunden)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Trigger
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Sensor Measurement Cycle             â”‚
â”‚                                              â”‚
â”‚  1. measureDistance()                        â”‚
â”‚     â”œâ”€ Trigger Pulse (10Î¼s)                 â”‚
â”‚     â”œâ”€ Wait for Echo                        â”‚
â”‚     â”œâ”€ Calculate Distance                   â”‚
â”‚     â””â”€ Return: float (cm)                   â”‚
â”‚                                              â”‚
â”‚  2. readTemperature()                        â”‚
â”‚     â”œâ”€ Request Temperature (1-Wire)         â”‚
â”‚     â”œâ”€ Wait 750ms                           â”‚
â”‚     â”œâ”€ Read Value                           â”‚
â”‚     â””â”€ Return: float (Â°C)                   â”‚
â”‚                                              â”‚
â”‚  3. readTurbidity()                          â”‚
â”‚     â”œâ”€ analogRead(A0)                       â”‚
â”‚     â”œâ”€ 10-bit ADC                           â”‚
â”‚     â””â”€ Return: int (0-1023)                 â”‚
â”‚                                              â”‚
â”‚  4. readTDS()                                â”‚
â”‚     â”œâ”€ analogRead(A1)                       â”‚
â”‚     â”œâ”€ 10-bit ADC                           â”‚
â”‚     â””â”€ Return: int (0-1023)                 â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Data Formatting                      â”‚
â”‚                                              â”‚
â”‚  String msg = "<SENSOR;";                   â”‚
â”‚  msg += "DIST=" + String(distance, 1) + ";â”‚
â”‚  msg += "TMP=" + String(temp, 1) + ";";    â”‚
â”‚  msg += "TUR=" + String(turb) + ";";       â”‚
â”‚  msg += "TDS=" + String(tds) + ">\n";      â”‚
â”‚                                              â”‚
â”‚  Beispiel:                                   â”‚
â”‚  <SENSOR;DIST=125.3;TMP=18.2;TUR=450;       â”‚
â”‚   TDS=320>\n                                 â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        RS-485 Transmission                  â”‚
â”‚                                              â”‚
â”‚  1. digitalWrite(DE, HIGH)  // TX Mode      â”‚
â”‚  2. delay(2ms)              // Settle       â”‚
â”‚  3. rs485.print(msg)        // Send         â”‚
â”‚  4. rs485.flush()           // Wait TX      â”‚
â”‚  5. delay(2ms)              // Settle       â”‚
â”‚  6. digitalWrite(DE, LOW)   // RX Mode      â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ RS-485 A/B Lines
                   â”‚ (Differential Signal)
                   â”‚ CAT7 Adern 5+6
                   â”‚
                   â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚   RS-485 Reception          â”‚
                                            â”‚                              â”‚
                                            â”‚  Serial1 RX Interrupt       â”‚
                                            â”‚  â””â”€ Byte empfangen          â”‚
                                            â”‚  â””â”€ In Buffer schreiben     â”‚
                                            â”‚                              â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚   Line Detection            â”‚
                                            â”‚                              â”‚
                                            â”‚  while (Serial1.available())â”‚
                                            â”‚    char c = read()          â”‚
                                            â”‚    if (c == '\n')           â”‚
                                            â”‚      process line           â”‚
                                            â”‚                              â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚   Protocol Validation       â”‚
                                            â”‚                              â”‚
                                            â”‚  if (line.startsWith("<"))  â”‚
                                            â”‚  if (line.indexOf("SENSOR"))â”‚
                                            â”‚    Valid â†’ Parse            â”‚
                                            â”‚  else                       â”‚
                                            â”‚    Discard                  â”‚
                                            â”‚                              â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚   Data Parsing              â”‚
                                            â”‚                              â”‚
                                            â”‚  extract("DIST") â†’ "125.3"  â”‚
                                            â”‚  extract("TMP")  â†’ "18.2"   â”‚
                                            â”‚  extract("TUR")  â†’ "450"    â”‚
                                            â”‚  extract("TDS")  â†’ "320"    â”‚
                                            â”‚                              â”‚
                                            â”‚  Append units:              â”‚
                                            â”‚  distance = "125.3 cm"      â”‚
                                            â”‚  temperature = "18.2 Â°C"    â”‚
                                            â”‚  turbidity = "450"          â”‚
                                            â”‚  tds = "320"                â”‚
                                            â”‚                              â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚   Nextion Update            â”‚
                                            â”‚                              â”‚
                                            â”‚  FÃ¼r jedes Feld:            â”‚
                                            â”‚                              â”‚
                                            â”‚  1. Format Command          â”‚
                                            â”‚     "tDist.txt=\"125.3 cm\"â”‚
                                            â”‚                              â”‚
                                            â”‚  2. Send to Nextion         â”‚
                                            â”‚     Serial2.print(cmd)      â”‚
                                            â”‚     Serial2.write(0xFF)     â”‚
                                            â”‚     Serial2.write(0xFF)     â”‚
                                            â”‚     Serial2.write(0xFF)     â”‚
                                            â”‚                              â”‚
                                            â”‚  3. Delay 10ms              â”‚
                                            â”‚     (Nextion processing)    â”‚
                                            â”‚                              â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚   Display Rendering         â”‚
                                            â”‚                              â”‚
                                            â”‚  Nextion STM32:             â”‚
                                            â”‚  - Parse Command            â”‚
                                            â”‚  - Update Text Object       â”‚
                                            â”‚  - Render to LCD            â”‚
                                            â”‚  - Send ACK (optional)      â”‚
                                            â”‚                              â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TIMING:
â”€â”€â”€â”€â”€â”€â”€
Sensor Measurement:     ~800ms (DS18B20 dominiert)
Data Formatting:        ~5ms
RS-485 Transmission:    ~10ms @ 9600 baud
RS-485 Reception:       ~10ms
Parsing:                ~2ms
Nextion Update:         ~50ms (4 Felder Ã— 10ms + overhead)
Display Rendering:      ~20ms

TOTAL LATENCY:          ~900ms vom Sensor bis Display
UPDATE INTERVAL:        5000ms (5 Sekunden)
```

### 2.3 Hardware-Architektur beider Nodes

#### 2.3.1 Sensor Node Hardware-Block-Diagramm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SENSOR NODE HARDWARE ARCHITEKTUR                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  ATmega4809 MCU      â”‚
                              â”‚  (Arduino Nano Every)â”‚
                              â”‚                      â”‚
                              â”‚  Clock: 20 MHz       â”‚
                              â”‚  Flash: 48 KB        â”‚
                              â”‚  SRAM:  6 KB         â”‚
                              â”‚  EEPROM: 256 B       â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                        â”‚                        â”‚
                â”‚                        â”‚                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Digital I/O    â”‚      â”‚  Analog Input   â”‚      â”‚  Serial I/O    â”‚
        â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
        â”‚  D2: TRIG       â”‚      â”‚  A0: Turbidity  â”‚      â”‚  D0: USB RX    â”‚
        â”‚  D3: ECHO       â”‚      â”‚  A1: TDS        â”‚      â”‚  D1: USB TX    â”‚
        â”‚  D4: OneWire    â”‚      â”‚                 â”‚      â”‚  D6: RS485 TX  â”‚
        â”‚  D5: RS485 DE   â”‚      â”‚  10-bit ADC     â”‚      â”‚  D7: RS485 RX  â”‚
        â”‚                 â”‚      â”‚  0-5V Range     â”‚      â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                        â”‚                        â”‚
                â”‚                        â”‚                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ JSN-SR04T       â”‚      â”‚ TSW-20M         â”‚      â”‚ MAX485          â”‚
        â”‚ Ultrasonic      â”‚      â”‚ Turbidity       â”‚      â”‚ RS-485 Driver   â”‚
        â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
        â”‚ - Waterproof    â”‚      â”‚ - Optical       â”‚      â”‚ - A Line        â”‚
        â”‚ - 2-400cm       â”‚      â”‚ - 0-5V Out      â”‚      â”‚ - B Line        â”‚
        â”‚ - VCC: 5V       â”‚      â”‚ - VCC: 5V       â”‚      â”‚ - DE/RE Ctrl    â”‚
        â”‚ - I: 15mA       â”‚      â”‚ - I: 5mA        â”‚      â”‚ - Half Duplex   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
        â”‚ DS18B20 (1-Wire)    CQRSENTDS01 (TDS)         â”‚          â”‚
        â”‚ Temperature         Conductivity               â”‚          â”‚
        â”‚                                                â”‚          â”‚
        â”‚ - Stainless Steel   - Electrode                â”‚          â”‚
        â”‚ - -55 to +125Â°C     - 0-1000ppm                â”‚          â”‚
        â”‚ - Â±0.5Â°C Accuracy   - 0-5V Out                 â”‚          â”‚
        â”‚ - 4.7kÎ© Pull-up     - VCC: 5V                  â”‚          â”‚
        â”‚ - VCC: 5V           - I: 5mA                   â”‚          â”‚
        â”‚ - I: 1mA            â”‚                          â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                                                    â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
                              â”‚  LM2596      â”‚                      â”‚
                              â”‚  Buck Conv.  â”‚                      â”‚
                              â”‚              â”‚                      â”‚
                              â”‚  Vin: 12V    â”‚                      â”‚
                              â”‚  Vout: 5V    â”‚                      â”‚
                              â”‚  Iout: 3A    â”‚                      â”‚
                              â”‚  Eff: 92%    â”‚                      â”‚
                              â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                      â”‚
                                  â”‚      â”‚                          â”‚
                    12V+ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€ 5V+ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜
                    (CAT7 1+2)                                      â”‚
                                                           To all 5V devices
                    GND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ GND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    (CAT7 3+4)

POWER CONSUMPTION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ATmega4809:      30 mA @ 5V, 20 MHz
JSN-SR04T:       15 mA @ 5V (measurement)
DS18B20:          1 mA @ 5V (conversion)
TSW-20M:          5 mA @ 5V (continuous)
CQRSENTDS01:      5 mA @ 5V (continuous)
MAX485:           1 mA @ 5V (receive mode)
                  5 mA @ 5V (transmit mode, <1% duty)

TOTAL AVG:       ~60 mA @ 5V = 0.3W @ 5V
               = ~30 mA @ 12V (considering converter efficiency)

PEAK (TX):       ~90 mA @ 5V = 0.45W @ 5V

THERMAL:
â”€â”€â”€â”€â”€â”€â”€â”€
LM2596 at 30mA input, 60mA output:
Power Loss = (12V Ã— 0.03A) - (5V Ã— 0.06A) = 0.36W - 0.30W = 0.06W
Temperature Rise: ~2-3Â°C above ambient (with heatsink)
```

#### 2.3.2 Display Node Hardware-Block-Diagramm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DISPLAY NODE HARDWARE ARCHITEKTUR                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  ATmega2560 MCU      â”‚
                              â”‚  (Arduino Mega 2560) â”‚
                              â”‚                      â”‚
                              â”‚  Clock: 16 MHz       â”‚
                              â”‚  Flash: 256 KB       â”‚
                              â”‚  SRAM:  8 KB         â”‚
                              â”‚  EEPROM: 4 KB        â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                        â”‚                        â”‚
                â”‚                        â”‚                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Serial 0       â”‚  â”‚  Serial 1       â”‚  â”‚  Serial 2       â”‚  â”‚  Serial 3       â”‚
        â”‚  (USB)          â”‚  â”‚  (SensorNode)   â”‚  â”‚  (Nextion)      â”‚  â”‚  (RelayNode)    â”‚
        â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
        â”‚  D0: RX         â”‚  â”‚  D19: RX1       â”‚  â”‚  D17: RX2       â”‚  â”‚  D15: RX3       â”‚
        â”‚  D1: TX         â”‚  â”‚  D18: TX1       â”‚  â”‚  D16: TX2       â”‚  â”‚  D14: TX3       â”‚
        â”‚  115200 baud    â”‚  â”‚  9600 baud      â”‚  â”‚  9600 baud      â”‚  â”‚  9600 baud      â”‚
        â”‚  Debug Only     â”‚  â”‚  Sensor Data    â”‚  â”‚  Display Ctrl   â”‚  â”‚  Relay Status   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                    â”‚                    â”‚                    â”‚
                â”‚                    â”‚                    â”‚                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  IÂ²C Bus        â”‚  â”‚  SPI Bus        â”‚  â”‚  GPIO           â”‚
        â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
        â”‚  D20: SDA       â”‚  â”‚  D50: MISO      â”‚  â”‚  D53: Status LEDâ”‚
        â”‚  D21: SCL       â”‚  â”‚  D51: MOSI      â”‚  â”‚                 â”‚
        â”‚                 â”‚  â”‚  D52: SCK       â”‚  â”‚                 â”‚
        â”‚  RTC DS3231 â°  â”‚  â”‚  D53: SD_CS     â”‚  â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                        â”‚                        â”‚

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ MAX485 #1      â”‚  â”‚ Nextion Displayâ”‚  â”‚ MAX485 #2      â”‚  â”‚ RTC DS3231 â°  â”‚
        â”‚ SensorNode     â”‚  â”‚ NX4024T032     â”‚  â”‚ RelayNode      â”‚  â”‚                 â”‚
        â”‚                â”‚  â”‚                â”‚  â”‚                â”‚  â”‚ - CR2032 Backup â”‚
        â”‚ A â† CAT7 #5    â”‚  â”‚ STM32F030      â”‚  â”‚ A â† Twisted A  â”‚  â”‚ - IÂ²C Address   â”‚
        â”‚ B â† CAT7 #6    â”‚  â”‚ 3.2" 320x240   â”‚  â”‚ B â† Twisted B  â”‚  â”‚   0x68          â”‚
        â”‚ DE/RE â†’ GND    â”‚  â”‚ 65K Colors     â”‚  â”‚ DE/RE â†’ GND    â”‚  â”‚                 â”‚
        â”‚ (RX only)      â”‚  â”‚ Touch Panel    â”‚  â”‚ (RX only)      â”‚  â”‚ - VCC: 5V       â”‚
        â”‚                â”‚  â”‚                â”‚  â”‚                â”‚  â”‚ - I: 1mA        â”‚
        â”‚ - VCC: 5V      â”‚  â”‚ - VCC: 5V      â”‚  â”‚ - VCC: 5V      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ - I: 1mA       â”‚  â”‚ - I: 85mA      â”‚  â”‚ - I: 1mA       â”‚  
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                     â”‚ SD Card Module â”‚
                                                                     â”‚ ğŸ’¾             â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚ - FAT32 Format  â”‚
                                                                     â”‚ - sensor.csv    â”‚
                                                                     â”‚ - relay.csv     â”‚
                                                                     â”‚ - Auto-create   â”‚
                                                                     â”‚                 â”‚
                                                                     â”‚ - VCC: 5V       â”‚
                                                                     â”‚ - I: 50mA       â”‚
                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  12V AC/DC Power     â”‚
                              â”‚  Supply              â”‚
                              â”‚                      â”‚
                              â”‚  Input: 100-240V AC  â”‚
                              â”‚  Output: 12V/2A      â”‚
                              â”‚  Protection:         â”‚
                              â”‚  - OVP, OCP, SCP     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â”‚ 12V
                                          â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  LM2596 Buck Conv.   â”‚
                              â”‚                      â”‚
                              â”‚  Vin: 12V            â”‚
                              â”‚  Vout: 5V (adjusted) â”‚
                              â”‚  Iout: 3A max        â”‚
                              â”‚  Efficiency: 92%     â”‚
                              â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                                  â”‚              â”‚
                    5V+ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€ To all 5V devices
                                         â”‚
                                         â”œâ”€ ATmega2560: 50mA
                                         â”œâ”€ MAX485: 1mA
                                         â””â”€ Nextion: 85mA
                    GND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

                    12V+ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ To Sensor Node
                    (CAT7 1+2)                          (CAT7 1+2)

                    GND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ To Sensor Node
                    (CAT7 3+4)                          (CAT7 3+4)

POWER CONSUMPTION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ATmega2560:      50 mA @ 5V = 0.25W
MAX485 #1 (RX):   1 mA @ 5V = 0.005W
MAX485 #2 (RX):   1 mA @ 5V = 0.005W
Nextion Display: 85 mA @ 5V = 0.425W
RTC DS3231:       1 mA @ 5V = 0.005W â°
SD Card Module:  50 mA @ 5V = 0.25W (during write) ğŸ’¾

TOTAL Display Node:  ~188 mA @ 5V = 0.94W @ 5V (peak during SD write)
TOTAL Display Node:  ~138 mA @ 5V = 0.69W @ 5V (average)

12V Power Supply Output:
- Display Node @ 5V:  0.94W / 0.92 (eff.) = 1.02W @ 12V = 85mA (peak)
- Sensor Node @ 12V:  0.30W / 1 (direct)   = 0.30W @ 12V = 25mA
- TOTAL 12V:          1.32W @ 12V â‰ˆ 110mA (peak)
- TOTAL 12V:          1.04W @ 12V â‰ˆ 87mA (average, typical)

12V/2A PSU is oversized â†’ Good for:
- Future expansions
- Inrush current handling
- Long-term reliability

THERMAL:
â”€â”€â”€â”€â”€â”€â”€â”€
LM2596 at 87mA input, 136mA output @ 5V:
Power Loss = (12V Ã— 0.087A) - (5V Ã— 0.136A) = 1.04W - 0.68W = 0.36W
Temperature Rise: ~10-15Â°C above ambient (with heatsink)

12V PSU at ~90mA load (rated 2A):
Load: 4.5% of rated capacity
Efficiency: ~85% (light load)
Temperature Rise: <20Â°C above ambient
```


### 2.4 Software-Architektur und Modulstruktur

#### 2.4.1 Sensor Node Software-Architektur

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              SENSOR NODE SOFTWARE ARCHITEKTUR                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            SensorNode.ino                                 â”‚
â”‚                          (Hauptprogramm)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚                   â”‚
         â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  config.h    â”‚    â”‚  sensors.h   â”‚    â”‚  rs485.h     â”‚
â”‚              â”‚    â”‚  sensors.cpp â”‚    â”‚  rs485.cpp   â”‚
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
â”‚ - Pin Defs   â”‚    â”‚ - Init       â”‚    â”‚ - Init       â”‚
â”‚ - Constants  â”‚    â”‚ - Distance   â”‚    â”‚ - Send       â”‚
â”‚ - Timing     â”‚    â”‚ - Temp       â”‚    â”‚ - DE Ctrl    â”‚
â”‚              â”‚    â”‚ - Turbidity  â”‚    â”‚              â”‚
â”‚              â”‚    â”‚ - TDS        â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                   â”‚
                           â”‚                   â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚         External Libraries                   â”‚
              â”‚                                              â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚ OneWire.h      â”‚  â”‚ SoftwareSerial.h  â”‚  â”‚
              â”‚  â”‚ (1-Wire Bus)   â”‚  â”‚ (RS-485 Serial)   â”‚  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
              â”‚  â”‚Dallas          â”‚                         â”‚
              â”‚  â”‚Temperature.h   â”‚                         â”‚
              â”‚  â”‚(DS18B20 Driver)â”‚                         â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PROGRAM FLOW:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

setup():
  â”œâ”€ Serial.begin(115200)           // Debug-Ausgabe
  â”œâ”€ sensors_begin()                // Sensoren initialisieren
  â”‚   â”œâ”€ pinMode(TRIG_PIN, OUTPUT)
  â”‚   â”œâ”€ pinMode(ECHO_PIN, INPUT)
  â”‚   â”œâ”€ digitalWrite(TRIG_PIN, LOW)
  â”‚   â”œâ”€ dsSensor.begin()           // OneWire DS18B20
  â”‚   â””â”€ delay(50)
  â””â”€ rs485_begin()                  // RS-485 initialisieren
      â”œâ”€ pinMode(RS485_DE, OUTPUT)
      â”œâ”€ digitalWrite(RS485_DE, LOW)
      â””â”€ rs485.begin(9600)

loop():
  â”œâ”€ Check Timer: millis() - lastSend >= SEND_INTERVAL (5000ms)
  â”‚
  â”œâ”€ If Timer Expired:
  â”‚   â”œâ”€ lastSend = millis()
  â”‚   â”‚
  â”‚   â”œâ”€ measureDistance()          // JSN-SR04T
  â”‚   â”‚   â”œâ”€ Trigger Pulse
  â”‚   â”‚   â”œâ”€ pulseIn(ECHO_PIN)
  â”‚   â”‚   â”œâ”€ Calculate: duration / 58.0
  â”‚   â”‚   â””â”€ Return: float (cm)
  â”‚   â”‚
  â”‚   â”œâ”€ readTemperature()          // DS18B20
  â”‚   â”‚   â”œâ”€ dsSensor.requestTemperatures()
  â”‚   â”‚   â”œâ”€ dsSensor.getTempCByIndex(0)
  â”‚   â”‚   â”œâ”€ Check DEVICE_DISCONNECTED_C
  â”‚   â”‚   â””â”€ Return: float (Â°C)
  â”‚   â”‚
  â”‚   â”œâ”€ readTurbidity()            // TSW-20M
  â”‚   â”‚   â”œâ”€ analogRead(TURB_PIN)
  â”‚   â”‚   â””â”€ Return: int (0-1023)
  â”‚   â”‚
  â”‚   â”œâ”€ readTDS()                  // CQRSENTDS01
  â”‚   â”‚   â”œâ”€ analogRead(TDS_PIN)
  â”‚   â”‚   â””â”€ Return: int (0-1023)
  â”‚   â”‚
  â”‚   â”œâ”€ Format Message String
  â”‚   â”‚   â”œâ”€ "<SENSOR;"
  â”‚   â”‚   â”œâ”€ "DIST=" + distance + ";"
  â”‚   â”‚   â”œâ”€ "TMP=" + temperature + ";"
  â”‚   â”‚   â”œâ”€ "TUR=" + turbidity + ";"
  â”‚   â”‚   â”œâ”€ "TDS=" + tds + ">"
  â”‚   â”‚   â””â”€ "\n"
  â”‚   â”‚
  â”‚   â”œâ”€ rs485_send(msg)            // RS-485 Transmission
  â”‚   â”‚   â”œâ”€ digitalWrite(RS485_DE, HIGH)
  â”‚   â”‚   â”œâ”€ delay(2)
  â”‚   â”‚   â”œâ”€ rs485.print(msg)
  â”‚   â”‚   â”œâ”€ rs485.flush()
  â”‚   â”‚   â”œâ”€ delay(2)
  â”‚   â”‚   â””â”€ digitalWrite(RS485_DE, LOW)
  â”‚   â”‚
  â”‚   â””â”€ Serial.print("Gesendet: " + msg)  // Debug
  â”‚
  â””â”€ Continue (no blocking)

MEMORY LAYOUT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Flash Usage:    ~10 KB / 48 KB (21%)
  - Arduino Core:        ~6 KB
  - OneWire Library:     ~1 KB
  - DallasTemp Library:  ~1 KB
  - SoftwareSerial:      ~0.5 KB
  - Application Code:    ~1.5 KB

SRAM Usage:     ~1 KB / 6 KB (17%)
  - Global Variables:    ~200 B
  - OneWire Objects:     ~100 B
  - String Buffers:      ~500 B
  - Stack (runtime):     ~200 B

EEPROM Usage:   0 B / 256 B (unused, available for calibration data)
```

#### 2.4.2 Display Node Software-Architektur

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              DISPLAY NODE SOFTWARE ARCHITEKTUR                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DisplayNode.ino                                â”‚
â”‚                          (Hauptprogramm)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚                   â”‚                 â”‚
         â–¼                   â–¼                   â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  config.h    â”‚    â”‚  rs485.h     â”‚    â”‚  nextion.h   â”‚  â”‚  parser.h    â”‚
â”‚              â”‚    â”‚  rs485.cpp   â”‚    â”‚  nextion.cpp â”‚  â”‚  parser.cpp  â”‚
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚  â”‚              â”‚
â”‚ - Serials    â”‚    â”‚ - Init       â”‚    â”‚ - Init       â”‚  â”‚ - Extract    â”‚
â”‚ - Pin Defs   â”‚    â”‚ - Receive    â”‚    â”‚ - Update     â”‚  â”‚ - Validate   â”‚
â”‚ - HMI Names  â”‚    â”‚              â”‚    â”‚ - Send Cmd   â”‚  â”‚ - Parse Msg  â”‚
â”‚              â”‚    â”‚              â”‚    â”‚ - 3xFF End   â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PROGRAM FLOW:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

setup():
  â”œâ”€ Serial.begin(115200)           // Debug-Ausgabe
  â”œâ”€ rs485_begin()                  // RS-485 Empfang initialisieren
  â”‚   â”œâ”€ pinMode(RS485_DE_PIN, OUTPUT) [optional]
  â”‚   â”œâ”€ digitalWrite(RS485_DE_PIN, LOW)
  â”‚   â””â”€ Serial1.begin(9600)
  â””â”€ nextion_begin()                // Nextion initialisieren
      â””â”€ Serial2.begin(9600)

loop():
  â”œâ”€ while (Serial1.available())    // RS-485 Buffer prÃ¼fen
  â”‚   â”œâ”€ char c = Serial1.read()
  â”‚   â”‚
  â”‚   â”œâ”€ if (c == '\n')             // Zeilenende erkannt
  â”‚   â”‚   â”œâ”€ line = rs485Buffer
  â”‚   â”‚   â”œâ”€ rs485Buffer = ""
  â”‚   â”‚   â”œâ”€ line.trim()
  â”‚   â”‚   â”‚
  â”‚   â”‚   â”œâ”€ if (line.startsWith("<") && line.indexOf("SENSOR") >= 0)
  â”‚   â”‚   â”‚   â”‚
  â”‚   â”‚   â”‚   â”œâ”€ parseSensorMessage(line)
  â”‚   â”‚   â”‚   â”‚   â”œâ”€ extract("DIST") â†’ "125.3"
  â”‚   â”‚   â”‚   â”‚   â”œâ”€ extract("TMP")  â†’ "18.2"
  â”‚   â”‚   â”‚   â”‚   â”œâ”€ extract("TUR")  â†’ "450"
  â”‚   â”‚   â”‚   â”‚   â”œâ”€ extract("TDS")  â†’ "320"
  â”‚   â”‚   â”‚   â”‚   â”œâ”€ Append Units
  â”‚   â”‚   â”‚   â”‚   â””â”€ Return: SensorData struct
  â”‚   â”‚   â”‚   â”‚
  â”‚   â”‚   â”‚   â””â”€ nextion_update(SensorData)
  â”‚   â”‚   â”‚       â”œâ”€ sendToNextion("tDist.txt=\"125.3 cm\"")
  â”‚   â”‚   â”‚       â”‚   â”œâ”€ Serial2.print(cmd)
  â”‚   â”‚   â”‚       â”‚   â”œâ”€ Serial2.write(0xFF)
  â”‚   â”‚   â”‚       â”‚   â”œâ”€ Serial2.write(0xFF)
  â”‚   â”‚   â”‚       â”‚   â””â”€ Serial2.write(0xFF)
  â”‚   â”‚   â”‚       â”œâ”€ delay(10)
  â”‚   â”‚   â”‚       â”œâ”€ sendToNextion("tTemp.txt=\"18.2 Â°C\"")
  â”‚   â”‚   â”‚       â”œâ”€ delay(10)
  â”‚   â”‚   â”‚       â”œâ”€ sendToNextion("tTurb.txt=\"450\"")
  â”‚   â”‚   â”‚       â”œâ”€ delay(10)
  â”‚   â”‚   â”‚       â””â”€ sendToNextion("tTDS.txt=\"320\"")
  â”‚   â”‚   â”‚
  â”‚   â”‚   â””â”€ Serial.println("Empfangen: " + line)  // Debug
  â”‚   â”‚
  â”‚   â”œâ”€ else
  â”‚   â”‚   â”œâ”€ rs485Buffer += c
  â”‚   â”‚   â””â”€ if (rs485Buffer.length() > 1024)  // Overflow-Schutz
  â”‚   â”‚       â””â”€ rs485Buffer = ""
  â”‚
  â””â”€ Continue (non-blocking)

MEMORY LAYOUT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Flash Usage:    ~15 KB / 256 KB (6%)
  - Arduino Core:        ~8 KB
  - Application Code:    ~7 KB
  - Parser Logic:        ~2 KB
  - Nextion Interface:   ~2 KB
  - RS-485 Handler:      ~1 KB

SRAM Usage:     ~2 KB / 8 KB (25%)
  - rs485Buffer (String):    ~1 KB (dynamic)
  - SensorData struct:       ~100 B
  - Nextion cmd buffers:     ~500 B
  - Stack (runtime):         ~400 B

DATA STRUCTURES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
struct SensorData {
  String distance;      // "125.3 cm"
  String temperature;   // "18.2 Â°C"
  String turbidity;     // "450"
  String tds;           // "320"
};
```

---



---

## 2.5 Code-Beispiele aus der Implementation

### 2.5.1 RTC DS3231 - Zeitstempel-Generierung â°

**RTC Initialisierung (DisplayNode/rtc.cpp):**

```cpp
bool rtc_begin() {
  if (!rtc.begin()) {
    Serial.println(F("ERROR: RTC not found!"));
    return false;
  }
  
  if (rtc.lostPower()) {
    Serial.println(F("WARNING: RTC lost power, setting to compile time"));
    rtc.adjust(DateTime(F(__DATE__), F(__TIME__)));
  }
  
  Serial.println(F("RTC ready"));
  return true;
}

String rtc_getTimestampString() {
  DateTime now = rtc.now();
  char buffer[20];
  sprintf(buffer, "%04d-%02d-%02d %02d:%02d:%02d",
          now.year(), now.month(), now.day(),
          now.hour(), now.minute(), now.second());
  return String(buffer);
}
```

**Verwendung im Hauptprogramm:**

```cpp
void loop() {
  // Bei Sensor-Daten-Empfang
  if (sensorDataReceived) {
    String timestamp = rtc_getTimestampString();
    // Timestamp: "2025-11-03 09:15:42"
    
    sdlogger_logSensor(timestamp, distance, temp, turbidity, tds);
  }
}
```

### 2.5.2 SD-Card Logger - Dual-CSV-System ğŸ’¾

**Sensor-Daten Logging (DisplayNode/sdlogger.cpp):**

```cpp
bool sdlogger_logSensor(const String &timestamp,
                        const String &distance,
                        const String &temperature,
                        const String &turbidity,
                        const String &tds) {
  File sensorFile = SD.open(SENSOR_LOG_FILE, FILE_WRITE);
  if (!sensorFile) {
    lastError = F("Failed to open sensor.csv");
    return false;
  }
  
  sensorFile.print(timestamp);
  sensorFile.print(',');
  sensorFile.print(distance);
  sensorFile.print(',');
  sensorFile.print(temperature);
  sensorFile.print(',');
  sensorFile.print(turbidity);
  sensorFile.print(',');
  sensorFile.println(tds);
  sensorFile.close();
  
  return true;
}
```

**Relay-Event Logging (DisplayNode/sdlogger.cpp):**

```cpp
bool sdlogger_logRelay(const String &timestamp,
                       const String &event,
                       const String &pumpState,
                       const String &ventState) {
  File relayFile = SD.open(RELAY_LOG_FILE, FILE_WRITE);
  if (!relayFile) {
    lastError = F("Failed to open relay.csv");
    return false;
  }
  
  relayFile.print(timestamp);
  relayFile.print(',');
  relayFile.print(event);
  relayFile.print(',');
  relayFile.print(pumpState);
  relayFile.print(',');
  relayFile.println(ventState);
  relayFile.close();
  
  return true;
}
```

**Periodisches Logging:**

```cpp
// Im Hauptprogramm (DisplayNode.ino)
unsigned long lastSensorLog = 0;
const unsigned long SENSOR_LOG_INTERVAL = 1200000; // 20 Minuten

void loop() {
  // Sensor-Logging alle 20 Minuten
  if (millis() - lastSensorLog >= SENSOR_LOG_INTERVAL) {
    if (sensorDataValid && rtc_isRunning()) {
      String timestamp = rtc_getTimestampString();
      sdlogger_logSensor(timestamp, 
                        lastSensorData.distance,
                        lastSensorData.temperature,
                        lastSensorData.turbidity,
                        lastSensorData.tds);
      lastSensorLog = millis();
    }
  }
  
  // Event-basiertes Relay-Logging bei StatusÃ¤nderung
  if (relayStateChanged) {
    String timestamp = rtc_getTimestampString();
    sdlogger_logRelay(timestamp, eventName, pumpState, ventState);
    relayStateChanged = false;
  }
}
```

### 2.5.3 RelayNode Nachrichtenformat

**Nachrichtenstruktur:**

```
<RELAY;PUMP=<state>;VENT=<state>;LED3=<state>;LED4=<state>>

MÃ¶gliche ZustÃ¤nde:
- IDLE: LED aus
- ACTIVE: LED an (steady)
- ERROR: LED blinkt

Beispiele:
<RELAY;PUMP=IDLE;VENT=IDLE;LED3=IDLE;LED4=IDLE>
<RELAY;PUMP=ACTIVE;VENT=IDLE;LED3=IDLE;LED4=IDLE>
<RELAY;PUMP=ERROR;VENT=ACTIVE;LED3=IDLE;LED4=IDLE>
```

**Parsing im DisplayNode (relay_parser.cpp):**

```cpp
RelayData parseRelayMessage(const String &message) {
  RelayData data;
  
  // Extrahiere einzelne Werte
  data.pumpState = extractValue(message, "PUMP=");
  data.ventState = extractValue(message, "VENT=");
  data.led3State = extractValue(message, "LED3=");
  data.led4State = extractValue(message, "LED4=");
  
  return data;
}

String extractValue(const String &message, const String &key) {
  int startIdx = message.indexOf(key);
  if (startIdx < 0) return "";
  
  startIdx += key.length();
  int endIdx = message.indexOf(';', startIdx);
  if (endIdx < 0) endIdx = message.indexOf('>', startIdx);
  
  return message.substring(startIdx, endIdx);
}
```

### 2.5.4 CSV-Datei-Formate

**sensor.csv** (Periodisch, alle 20 Minuten):

```csv
Timestamp,Distance_cm,Temperature_C,Turbidity,TDS_ppm
2025-11-03 09:00:00,125.3,18.2,450,320
2025-11-03 09:20:00,124.8,18.3,452,318
2025-11-03 09:40:00,125.1,18.2,448,322
```

**relay.csv** (Event-getrieben, bei StatusÃ¤nderung):

```csv
Timestamp,Event,Pump_State,Vent_State
2025-11-03 09:00:00,INITIAL,IDLE,IDLE
2025-11-03 09:15:30,PUMP_ACTIVE,ACTIVE,IDLE
2025-11-03 09:30:15,PUMP_IDLE,IDLE,IDLE
2025-11-03 10:05:42,PUMP_ERROR,ERROR,IDLE
2025-11-03 10:10:18,VENT_ACTIVE,ERROR,ACTIVE
```

### 2.5.5 DisplayNode v2.0 Pin-Allokation

**Komplette Pin-Ãœbersicht:**

| Interface | Pins | Komponente | Baudrate/Protokoll |
|-----------|------|------------|-------------------|
| Serial0 (USB) | D0/D1 | Debug (PC) | 115200 Baud |
| Serial1 | D18/D19 | SensorNode RS-485 | 9600 Baud |
| Serial2 | D16/D17 | Nextion Display | 9600 Baud |
| Serial3 | D14/D15 | RelayNode RS-485 | 9600 Baud |
| IÂ²C | D20 (SDA) / D21 (SCL) | RTC DS3231 | IÂ²C @ 0x68 |
| SPI | D50-D53 | SD-Card Module | SPI @ 4 MHz |
| GPIO | D53 | Status-LED (SD-Card) | Digital Out |

**Vorteile dieser Architektur:**

- âœ… Alle Serials auf Hardware-UART (stabil, kein CPU-Overhead)
- âœ… Keine Pin-Konflikte zwischen Interfaces
- âœ… Standard-Pins fÃ¼r IÂ²C und SPI auf Mega
- âœ… UnabhÃ¤ngige DatenstrÃ¶me ohne Interferenz


## 3. Systemkomponenten

### 3.1 Mikrocontroller

#### 3.1.1 Arduino Nano Every (Sensor Node)

**Basierte auf ATmega4809 Mikrocontroller**

**Technische Spezifikationen:**

| Parameter | Wert | Notizen |
|-----------|------|---------|
| Architektur | AVR (8-bit RISC) | Verbessert gegenÃ¼ber ATmega328P |
| CPU Takt | 20 MHz | HÃ¶her als Nano (16 MHz) |
| Flash Memory | 48 KB | 3x grÃ¶ÃŸer als Nano |
| SRAM | 6 KB | 3x grÃ¶ÃŸer als Nano |
| EEPROM | 256 Bytes | FÃ¼r Kalibrierungsdaten |
| Betriebsspannung | 5V | Ãœber VIN (7-12V) oder 5V-Pin |
| I/O Pins | 22 Digital, 8 Analog | 14 davon PWM-fÃ¤hig |
| ADC AuflÃ¶sung | 10-bit (0-1023) | 0-5V Bereich |
| UART | 1x Hardware | FÃ¼r USB (Debug) |
| I2C | 1x | Nicht verwendet |
| SPI | 1x | Nicht verwendet |
| Stromverbrauch | 30 mA @ 5V, 20 MHz | Active Mode |
| MaÃŸe | 45 Ã— 18 mm | Kompatibel mit Breadboards |

**Pin-Nutzung im BioSync-System:**

| Pin | Funktion | Komponente | Signal-Typ | Notizen |
|-----|----------|------------|------------|---------|
| VIN | 5V Eingang | LM2596 OUT+ | Power | Von Step-Down-Wandler |
| GND | Ground | Gemeinsam | Power | Alle Komponenten verbunden |
| D2 | Trigger | JSN-SR04T | Digital Out | 10Î¼s Puls |
| D3 | Echo | JSN-SR04T | Digital In | PulslÃ¤nge = Distanz |
| D4 | 1-Wire Data | DS18B20 | Digital I/O | Mit 4.7kÎ© Pull-up |
| D5 | DE/RE | RS-485 Modul | Digital Out | TX-Kontrolle |
| D6 | TX | RS-485 Modul (DI) | Serial TX | SoftwareSerial |
| D7 | RX | RS-485 Modul (RO) | Serial RX | SoftwareSerial |
| A0 | TrÃ¼bung | TSW-20M | Analog In | 0-1023 |
| A1 | TDS | CQRSENTDS01 | Analog In | 0-1023 |
| D0 | USB RX | PC (Debug) | Serial RX | Hardware Serial |
| D1 | USB TX | PC (Debug) | Serial TX | Hardware Serial |

**Besonderheiten:**

- **Kein Bootloader-Delay:** ATmega4809 startet sofort nach Power-On
- **Erweiterte Peripherie:** Mehr Timer und Interrupts als ATmega328P
- **Lower Power Modi:** Sleep-Modi fÃ¼r zukÃ¼nftige Batteriebetrieb-Erweiterungen
- **Built-in LED:** D13 fÃ¼r Status-Anzeige (nicht verwendet)

**Elektrische Eigenschaften:**

- **Absolute Maximum Ratings:**
  - VIN: -0.5V bis +20V
  - 5V Pin: 4.5V bis 5.5V
  - I/O Pin: -0.5V bis Vcc+0.5V
  - Max Current per I/O: 40 mA
  - Max Total I/O Current: 200 mA

- **Empfohlene Betriebsbedingungen:**
  - VIN: 7V bis 12V (fÃ¼r LDO-Regler)
  - 5V Pin: 5.0V Â±5%
  - I/O Drive: 20 mA per Pin
  - Temperature: -40Â°C bis +85Â°C

#### 3.1.2 Arduino Mega 2560 (Display Node)

**Basiert auf ATmega2560 Mikrocontroller**

**Technische Spezifikationen:**

| Parameter | Wert | Notizen |
|-----------|------|---------|
| Architektur | AVR (8-bit RISC) | GroÃŸer Bruder des ATmega328P |
| CPU Takt | 16 MHz | Standard Arduino Takt |
| Flash Memory | 256 KB | Viel Platz fÃ¼r komplexe Anwendungen |
| SRAM | 8 KB | Genug fÃ¼r groÃŸe Daten-Buffers |
| EEPROM | 4 KB | FÃ¼r Konfiguration und Logs |
| Betriebsspannung | 5V | Ãœber VIN (7-12V) oder 5V-Pin |
| I/O Pins | 54 Digital, 16 Analog | 15 davon PWM-fÃ¤hig |
| ADC AuflÃ¶sung | 10-bit (0-1023) | 0-5V Bereich |
| **UART** | **4x Hardware Serial** | **Hauptvorteil fÃ¼r BioSync!** |
| I2C | 1x (TWI) | Nicht verwendet |
| SPI | 1x | Nicht verwendet |
| Stromverbrauch | 50 mA @ 5V, 16 MHz | Active Mode |
| MaÃŸe | 101.5 Ã— 53.3 mm | GroÃŸ, aber viele Pins |

**Pin-Nutzung im BioSync-System:**

| Pin | Funktion | Komponente | Signal-Typ | Notizen |
|-----|----------|------------|------------|---------|
| 5V | 5V Eingang | LM2596 OUT+ | Power | Von Step-Down-Wandler |
| GND | Ground | Gemeinsam | Power | Alle Komponenten verbunden |
| D0 | USB RX | PC (Debug) | Serial0 RX | Hardware Serial 0 |
| D1 | USB TX | PC (Debug) | Serial0 TX | Hardware Serial 0 |
| **D19** | **RS-485 RX** | **RS-485 Modul (RO)** | **Serial1 RX** | **Hardware Serial 1** |
| **D18** | **RS-485 TX** | **RS-485 Modul (DI)** | **Serial1 TX** | **Hardware Serial 1** |
| **D17** | **Nextion RX** | **Nextion Display (TX)** | **Serial2 RX** | **Hardware Serial 2** |
| **D16** | **Nextion TX** | **Nextion Display (RX)** | **Serial2 TX** | **Hardware Serial 2** |
| D10 | DE/RE | RS-485 Modul | Digital Out | Optional, meist GND |
| D2-D53 | GPIO | Expansion | Digital I/O | Reserve fÃ¼r Erweiterungen |
| A0-A15 | Analog In | Expansion | Analog In | Reserve fÃ¼r Erweiterungen |

**Hauptvorteil: 4 Hardware-Serial-Ports**

Der Arduino Mega ist speziell wegen seiner **4 Hardware-UART-Ports** gewÃ¤hlt:

1. **Serial0 (D0/D1):** USB-Debugging (nicht in Produktion verwendet)
2. **Serial1 (D19/D18):** RS-485 Kommunikation mit Sensor Node
3. **Serial2 (D17/D16):** Nextion Display Kommunikation
4. **Serial3 (D15/D14):** Reserve fÃ¼r zukÃ¼nftige Erweiterungen (z.B. GPS, GSM)

**Warum Hardware-Serial statt SoftwareSerial?**

| Aspekt | Hardware Serial | Software Serial |
|--------|----------------|----------------|
| StabilitÃ¤t | â­â­â­â­â­ Sehr stabil | â­â­â­ Okay, aber anfÃ¤llig |
| Max. Baudrate | Bis 2 Mbps | Bis 115200 bps (instabil) |
| Interrupts | Keine BeeintrÃ¤chtigung | Blockiert andere Interrupts |
| CPU Last | Minimal (<1%) | ~10-20% bei 9600 baud |
| Buffer | 64 Bytes Hardware-FIFO | Software-Buffer (fehleranfÃ¤llig) |
| Gleichzeitigkeit | Mehrere gleichzeitig | Nur eines aktiv |

**Elektrische Eigenschaften:**

- **Absolute Maximum Ratings:**
  - VIN: -0.5V bis +20V
  - 5V Pin: 4.5V bis 5.5V
  - I/O Pin: -0.5V bis Vcc+0.5V
  - Max Current per I/O: 40 mA
  - Max Total I/O Current: 200 mA (Summe aller Pins)

- **Empfohlene Betriebsbedingungen:**
  - VIN: 7V bis 12V (fÃ¼r LDO-Regler on-board)
  - 5V Pin: 5.0V Â±5%
  - I/O Drive: 20 mA per Pin (empfohlen)
  - Temperature: -40Â°C bis +85Â°C

### 3.2 Sensoren (Detailliert)

#### 3.2.1 JSN-SR04T - Wasserdichter Ultraschallsensor

**Funktionsprinzip: Ultraschall-Laufzeitmessung**

Der JSN-SR04T sendet einen 40 kHz Ultraschallimpuls aus und misst die Zeit bis zum Empfang des Echos. Die Distanz wird aus der Laufzeit berechnet:

```
Distanz (cm) = (Laufzeit (Î¼s) Ã— Schallgeschwindigkeit (cm/Î¼s)) / 2

Bei 20Â°C Lufttemperatur:
Schallgeschwindigkeit â‰ˆ 343 m/s = 0.0343 cm/Î¼s
                       â‰ˆ 1 cm / 29 Î¼s (Hin- und RÃ¼ckweg)
                       â‰ˆ 1 cm / 58 Î¼s (nur Hinweg)

Vereinfacht: Distanz (cm) = Laufzeit (Î¼s) / 58
```

**Technische Spezifikationen:**

| Parameter | Wert | Einheit | Notizen |
|-----------|------|---------|---------|
| Betriebsspannung | 5 | V DC | Â±10% toleriert |
| Stromverbrauch | 15 (Messung), <2 (Standby) | mA | Nur wÃ¤hrend Messung |
| Frequenz | 40 | kHz | Ultraschall |
| Messbereich | 25 - 450 | cm | Blind zone: <25cm |
| AuflÃ¶sung | 1 | cm | Theoretisch 0.3cm |
| Genauigkeit | Â±1 | cm | Bei idealen Bedingungen |
| Ã–ffnungswinkel | 75 | Â° | KegelfÃ¶rmig |
| Trigger-Puls | 10 | Î¼s | HIGH-Puls zum Starten |
| Echo-Puls | Proportional | Î¼s | HIGH-Dauer = Distanz |
| Max. Echo-Wartezeit | 38 | ms | Timeout fÃ¼r max. Distanz |
| Schutzklasse | IP68 | - | VollstÃ¤ndig wasserdicht |
| Betriebstemperatur | -10 bis +60 | Â°C | Erweitert fÃ¼r Outdoor |
| Kabel-lÃ¤nge | 2.5 | m | Standard, erweiterbar |

**Pinbelegung:**

| Pin | Farbe (Standard) | Funktion | Verbindung |
|-----|------------------|----------|------------|
| 1 | Rot | VCC (+5V) | Arduino 5V |
| 2 | Braun | TRIG | Arduino D2 |
| 3 | Gelb | ECHO | Arduino D3 |
| 4 | Schwarz | GND | Arduino GND |

**Verkabelung und Anschluss:**

```
JSN-SR04T Main Board          Separate Transducer Probe
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚           â”‚    Waterproof   â”‚
â”‚  VCC   â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  40kHz Ultra-   â”‚
â”‚  TRIG  â”€â”€â”€â”€â”€â”  â”‚ 2.5m      â”‚  sonic Trans-   â”‚
â”‚  ECHO  â”€â”€â”€â” â”‚  â”‚ Cable     â”‚  ducer & RX     â”‚
â”‚  GND   â”€â” â”‚ â”‚  â”‚           â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚â”‚ â”‚                  (Submersible, IP68)
         â”‚â”‚ â”‚
      To Arduino Nano Every:
      â”‚â”‚ â”‚
      â”‚â”‚ â””â”€â”€ D2 (TRIG)
      â”‚â””â”€â”€â”€â”€ D3 (ECHO)
      â””â”€â”€â”€â”€â”€ GND

VCC â”€â”€â”€â”€â”€â”€â”€ 5V (aus LM2596)
```

**Software-Integration:**

```cpp
// In sensors.cpp:

float measureDistance() {
  // 1. Sensor zurÃ¼cksetzen
  digitalWrite(TRIG_PIN, LOW);
  delayMicroseconds(2);
  
  // 2. Trigger-Puls senden (10Î¼s HIGH)
  digitalWrite(TRIG_PIN, HIGH);
  delayMicroseconds(10);
  digitalWrite(TRIG_PIN, LOW);
  
  // 3. Echo-Puls messen (Timeout 30ms = ~500cm max)
  unsigned long duration = pulseIn(ECHO_PIN, HIGH, 30000);
  
  // 4. Timeout-Check (Sensor auÃŸerhalb Reichweite)
  if (duration == 0) {
    return -1.0;  // Fehlercode
  }
  
  // 5. Berechnung: duration(Î¼s) / 58 = distance(cm)
  float distance = duration / 58.0;
  
  return distance;
}
```

**Messgenauigkeit und FehlereinflÃ¼sse:**

| Einflussfaktor | Auswirkung | Kompensation |
|----------------|------------|--------------|
| Lufttemperatur | Â±1% pro 10Â°C | Temperaturkorrektur-Formel anwenden |
| Luftfeuchtigkeit | <0.5% | VernachlÃ¤ssigbar |
| Winkel zur OberflÃ¤che | Bei >15Â° ungenau | Sensor senkrecht montieren |
| Schaumbildung | Echo-DÃ¤mpfung | WasseroberflÃ¤che bevorzugen |
| Mehrfach-Reflexionen | Geister-Echos | Software-Filter (PlausibilitÃ¤t) |
| Elektrische StÃ¶rungen | Sporadische Fehler | Abschirmung, Fehlerfilter |

**Temperatur-Korrektur (optional):**

```cpp
// Wenn hÃ¶here Genauigkeit benÃ¶tigt:
float measureDistanceCompensated(float tempCelsius) {
  unsigned long duration = pulseIn(ECHO_PIN, HIGH, 30000);
  if (duration == 0) return -1.0;
  
  // Schallgeschwindigkeit bei Temp. T:
  // v(T) = 331.3 + 0.606 Ã— T  [m/s]
  float speedOfSound = 331.3 + 0.606 * tempCelsius;  // m/s
  
  // Distanz berechnen: d = (v Ã— t) / 2
  // speedOfSound in cm/Î¼s = speedOfSound / 10000
  float distance = (speedOfSound / 10000.0) * duration / 2.0;
  
  return distance;
}
```

**Kalibrierung (siehe CALIBRATION_PROCEDURES.md fÃ¼r Details):**

1. **Offset-Kalibrierung:**
   - Sensor auf bekannte Distanz (z.B. 100 cm) montieren
   - Mehrere Messungen durchfÃ¼hren (n=20)
   - Mittelwert berechnen
   - Offset = Sollwert - Mittelwert
   - Formel: `distance_korrigiert = distance_roh + offset`

2. **Skalierungsfaktor:**
   - Standard: 58 Î¼s/cm
   - Bei Abweichungen: Faktor anpassen (z.B. 57.5 oder 58.5)
   - Ãœber mehrere Distanzen (50cm, 100cm, 200cm) validieren

**Montage und Installation:**

- **Position:** Ãœber der WasseroberflÃ¤che, senkrecht nach unten
- **Abstand:** Mindestens 25 cm Ã¼ber hÃ¶chstem Wasserstand (Blind Zone)
- **Befestigung:** Stabile Halterung, keine Vibrationen
- **KabelfÃ¼hrung:** Wasserdichte Kabelverschraubung, Zugentlastung
- **Ausrichtung:** Kegelwinkel 75Â° beachten, keine Hindernisse im Kegel

**Wartung:**

- **Reinigung:** Transducer alle 3 Monate mit destilliertem Wasser reinigen
- **SichtprÃ¼fung:** Kabel auf BeschÃ¤digungen prÃ¼fen
- **Kalibrierung:** JÃ¤hrlich Offset-Kalibrierung wiederholen
- **Austausch:** Bei Genauigkeitsverlust oder BeschÃ¤digung

**Fehlerdiagnose:**

| Symptom | Ursache | LÃ¶sung |
|---------|---------|--------|
| Konstant -1.0 (Timeout) | Echo zu schwach oder Sensor defekt | 1. Reichweite prÃ¼fen 2. Kabel prÃ¼fen 3. Sensor tauschen |
| Unstabile Werte (Jitter) | Schaumbildung oder Mehrfach-Reflexion | Software-Filter (gleitender Mittelwert) |
| Konstant 0 cm | ECHO-Pin nicht verbunden | Verkabelung prÃ¼fen (D3) |
| Werte zu hoch | Falscher Skalierungsfaktor | Faktor von 58 anpassen (z.B. 57 oder 59) |

